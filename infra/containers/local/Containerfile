FROM docker.io/library/golang:1.24

WORKDIR /app

# Install air for live reloading
RUN go install github.com/air-verse/air@latest

# Install goose for migrations
RUN go install github.com/pressly/goose/v3/cmd/goose@latest

# Install templ for template generation
RUN go install github.com/a-h/templ/cmd/templ@latest

# Copy Go module files first for better caching
COPY go.mod go.sum ./

# Download dependencies
RUN go mod download

# Copy source code
COPY . .

RUN chmod +x infra/containers/local/entrypoint.sh

EXPOSE 8080

# Use development entrypoint that runs migrations then starts air
ENTRYPOINT ["infra/containers/local/entrypoint.sh"]
